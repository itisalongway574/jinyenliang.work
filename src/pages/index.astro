---
import BaseLayout from "../layouts/BaseLayout.astro";
import MarqueeColumn from "../components/MarqueeColumn.astro";
import MarqueeItem from "../components/MarqueeItem.astro";
import "../styles/global.css";
import img1 from "../assets/img-1.jpg";
import img2 from "../assets/img-2.jpg";
import img3 from "../assets/img-3.jpg";
import img4 from "../assets/img-4.jpg";
import img5 from "../assets/img-5.jpg";
import { createMarqueeItems } from "../utils/marqueeData.js";
import marqueeControllerUrl from "../scripts/marqueeController.js?url";

// 來源圖片池：後續可替換為資料來源或 CMS
const images = [img1, img2, img3, img4, img5];
// 總項目數（桌機會分成左右兩欄，手機合併）
const totalItems = 20;
// 資料層：生成清單與分欄結果
const { marqueeItemsLeft, marqueeItemsRight, marqueeItemsMobile } =
    createMarqueeItems({ images, totalItems });
---

<BaseLayout>
    <main class="relative min-h-screen">
        <aside
            class="fixed left-0 top-0 flex h-screen w-1/3 flex-col justify-between px-6 py-10 md:w-[30%]"
        >
            <div class="space-y-4">
                <h1 class="text-3xl tracking-wide">JIN YEN-LIANG</h1>
                <p class="text-sm">web design &amp; fronted-end develop</p>
            </div>
            <div class="flex gap-3 text-xs">
                <span>instagram</span>
                <span>/</span>
                <span>threads</span>
                <span>/</span>
                <span>e-mail</span>
            </div>
        </aside>
        <section
            class="ml-[33.333%] h-screen w-[66.666%] md:ml-[30%] md:w-[70%]"
        >
            <!-- 桌機左右欄：JS 控制進度 + wheel/drag/touch 共用邏輯 -->
            <div
                class="marquee-drag-area hidden h-full gap-6 md:flex"
                data-marquee-group="desktop"
            >
                <!-- 左欄：自動往上，wheel 向下時會反向 -->
                <MarqueeColumn items={marqueeItemsLeft} dataMarquee="css" />
                <!-- 右欄：自動往下，wheel 向下時會反向 -->
                <MarqueeColumn
                    items={marqueeItemsRight}
                    dataMarquee="css-reverse"
                    liClass="self-end"
                />
            </div>
            <!-- 手機版：純 CSS animation，維持合併清單 -->
            <div class="h-full md:hidden">
                <div
                    class="group/marquee relative h-[100dvh] w-full overflow-hidden"
                >
                    <ul
                        class="flex flex-col gap-6 will-change-transform animate-[marquee-vertical_26s_linear_infinite]"
                    >
                        {
                            marqueeItemsMobile.map((item) => (
                                <MarqueeItem item={item} liClass="self-end" />
                            ))
                        }
                    </ul>
                </div>
            </div>
        </section>
    </main>
    <script type="module" src={marqueeControllerUrl}></script>

    <style is:global>
        .is-dragging,
        .is-dragging * {
            cursor: grabbing;
        }

        .marquee-drag-area {
            cursor: grab;
        }

        .marquee-no-drag {
            -webkit-user-drag: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        @layer utilities {
            /* 手機版純 CSS：固定時間內向上位移 -50%，搭配清單重複達成循環 */
            @keyframes marquee-vertical {
                0% {
                    transform: translateY(0);
                }

                100% {
                    transform: translateY(-50%);
                }
            }

            /* 桌機版 JS：透過 CSS 變數控制位移 */
            .marquee-wheel {
                transform: translateY(var(--marquee-offset, 0px));
            }

            .marquee-reverse {
                animation-direction: reverse;
            }
        }
    </style>
</BaseLayout>
